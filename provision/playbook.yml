---
#
# Ansible playbook for a developer server featuring Consul
# for service discovery.
#
# @author Chris Stevens https://github.com/stevenscg
#


- hosts: all
  gather_facts: yes

  vars:
    consul_datacenter: local
    consul_bootstrap_expect: 1

  roles:
    - role: repo-remi
      tags:
        - repos

    - role: php
      php_enable_php_fpm: true
      php_webserver_daemon: nginx
      php_opcache_enabled_in_ini: true
      php_enablerepo: "remi,remi-php70"
      tags:
        - php

    - role: composer
      tags:
        - php

    - role: nginx
      tags:
        - nginx

    - role: supervisor
      supervisor_bin_dir: /usr/bin
      tags:
        - supervisor

    - role: consul
      consul_is_server: true
      # consul_node_name: "{{ consul_name_prefix }}::{{ ansible_ec2_instance_id }}"
      # consul_bind_address: "{{ ansible_default_ipv4['address'] }}"
      consul_install_dnsmasq: true
      consul_install_ui: true
      tags:
        - consul
